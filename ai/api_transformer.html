<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformer API æ£€æµ‹æ¼”ç¤º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3b82f6 100%);
            color: #e5e7eb;
            min-height: 100vh;
            font-family: 'Noto Sans SC', sans-serif;
        }
        .stage-box {
            border: 2px solid #4b5563;
            background: rgba(31, 41, 55, 0.8);
            transition: all 0.5s ease-in-out;
            min-height: 120px;
        }
        .stage-box.active {
            border-color: #8b5cf6;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.6);
        }
        .progress-bar {
            background: linear-gradient(90deg, #8b5cf6, #a855f7);
            height: 4px;
            border-radius: 2px;
            transition: width 0.5s ease-in-out;
        }
        .anomaly-score {
            background: linear-gradient(45deg, #ef4444, #f87171);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        .normal-score {
            background: linear-gradient(45deg, #22c55e, #4ade80);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Transformer WAF æ£€æµ‹è¿‡ç¨‹æ¼”ç¤º</h1>
            <p class="text-xl text-gray-300">åŸºäºTransformeræ¶æ„çš„HTTPå‚æ•°å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿ</p>
        </header>

        <div class="text-center mb-8">
            <button id="start-demo-btn" class="bg-violet-600 hover:bg-violet-700 text-white font-bold py-4 px-8 rounded-lg transition-all duration-300 shadow-lg text-lg">
                ğŸš€ å¼€å§‹æ¼”ç¤º
            </button>
            <div class="mt-4">
                <label class="text-white mr-4">é€‰æ‹©æµ‹è¯•ç”¨ä¾‹:</label>
                <select id="test-case-select" class="bg-gray-800 text-white px-3 py-2 rounded border border-gray-600">
                    <option value="normal">æ­£å¸¸è¯·æ±‚</option>
                    <option value="sql-injection">SQLæ³¨å…¥æ”»å‡»</option>
                    <option value="xss">XSSæ”»å‡»</option>
                    <option value="path-traversal">è·¯å¾„éå†æ”»å‡»</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- å·¦ä¾§ï¼šç³»ç»Ÿæ¶æ„ -->
            <div class="lg:col-span-1 p-6 rounded-xl relative">
                <h2 class="text-2xl font-bold mb-6 text-center text-violet-400">ğŸ—ï¸ ç³»ç»Ÿæ¶æ„</h2>
                
                <div id="system-architecture" class="space-y-4">
                    <!-- HTTPè¯·æ±‚å¤„ç†å±‚ -->
                    <div id="stage-http" class="stage-box p-4 rounded-lg">
                        <h3 class="font-semibold text-lg">ğŸŒ HTTPè¯·æ±‚å¤„ç†å±‚</h3>
                        <div id="http-request" class="mt-2 text-sm bg-gray-800 p-2 rounded"></div>
                    </div>
                    
                    <div class="text-center text-2xl text-violet-500">â†“</div>
                    
                    <!-- ç‰¹å¾æå–å±‚ -->
                    <div id="stage-features" class="stage-box p-4 rounded-lg">
                        <h3 class="font-semibold text-lg">ğŸ” ç‰¹å¾æå–å±‚</h3>
                        <div id="feature-extraction" class="mt-4 space-y-2">
                            <div class="bg-gray-800 p-3 rounded" id="statistical-features">
                                <h4 class="font-medium text-violet-300">ğŸ“Š ç»Ÿè®¡ç‰¹å¾</h4>
                                <div id="stat-features-data" class="text-sm text-gray-400"></div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded" id="semantic-features">
                                <h4 class="font-medium text-violet-300">ğŸ§  è¯­ä¹‰ç‰¹å¾</h4>
                                <div id="sem-features-data" class="text-sm text-gray-400"></div>
                            </div>
                            <div class="bg-gray-800 p-3 rounded" id="structural-features">
                                <h4 class="font-medium text-violet-300">ğŸ—ï¸ ç»“æ„ç‰¹å¾</h4>
                                <div id="struct-features-data" class="text-sm text-gray-400"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center text-2xl text-violet-500">â†“</div>
                    
                    <!-- Transformeræ£€æµ‹å±‚ -->
                    <div id="stage-transformer" class="stage-box p-4 rounded-lg">
                        <h3 class="font-semibold text-lg">âš¡ Transformeræ£€æµ‹å±‚</h3>
                        <div id="transformer-process" class="mt-4 space-y-4">
                            <div id="attention-mechanism" class="p-3 bg-gray-800/50 rounded-lg opacity-0 transition-opacity duration-500">
                                <h4 class="font-medium text-violet-300">ğŸ‘ï¸ å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</h4>
                                <div id="attention-vis" class="mt-2 h-32 relative"></div>
                            </div>
                            <div id="feed-forward" class="p-3 bg-gray-800/50 rounded-lg opacity-0 transition-opacity duration-500">
                                <h4 class="font-medium text-violet-300">ğŸ”„ å‰é¦ˆç½‘ç»œ</h4>
                                <div id="ffn-vis" class="mt-2 h-12 flex items-center"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center text-2xl text-violet-500">â†“</div>
                    
                    <!-- å†³ç­–å±‚ -->
                    <div id="stage-decision" class="stage-box p-4 rounded-lg">
                        <h3 class="font-semibold text-lg">ğŸ¯ å†³ç­–å±‚</h3>
                        <div id="decision-result" class="mt-2 text-lg font-bold"></div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ£€æµ‹è¿‡ç¨‹ -->
            <div class="lg:col-span-1 p-6 rounded-xl relative">
                <h2 class="text-2xl font-bold mb-6 text-center text-violet-400">ğŸ” æ£€æµ‹è¿‡ç¨‹</h2>
                
                <div id="detection-process" class="space-y-6">
                    <!-- è¿›åº¦æ¡ -->
                    <div class="bg-gray-800 rounded-lg p-4">
                        <div class="flex justify-between text-sm mb-2">
                            <span>æ£€æµ‹è¿›åº¦</span>
                            <span id="progress-text">0%</span>
                        </div>
                        <div class="bg-gray-700 rounded-full h-2">
                            <div id="progress-bar" class="progress-bar rounded-full h-2" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- å®æ—¶æ—¥å¿— -->
                    <div class="bg-gray-800 rounded-lg p-4">
                        <h3 class="font-semibold mb-2">ğŸ“ å®æ—¶æ—¥å¿—</h3>
                        <div id="log-container" class="text-sm text-gray-300 h-64 overflow-y-auto bg-gray-900 p-3 rounded">
                            <div class="log-entry" id="init-log">ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ...</div>
                        </div>
                    </div>
                    
                    <!-- æ€§èƒ½æŒ‡æ ‡ -->
                    <div class="bg-gray-800 rounded-lg p-4">
                        <h3 class="font-semibold mb-2">ğŸ“Š æ€§èƒ½æŒ‡æ ‡</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <div class="text-gray-400">æ¨ç†æ—¶é—´</div>
                                <div id="inference-time" class="text-violet-300">0ms</div>
                            </div>
                            <div>
                                <div class="text-gray-400">å†…å­˜ä½¿ç”¨</div>
                                <div id="memory-usage" class="text-violet-300">0MB</div>
                            </div>
                            <div>
                                <div class="text-gray-400">CPUä½¿ç”¨ç‡</div>
                                <div id="cpu-usage" class="text-violet-300">0%</div>
                            </div>
                            <div>
                                <div class="text-gray-400">æ£€æµ‹å‡†ç¡®ç‡</div>
                                <div id="accuracy" class="text-violet-300">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// æµ‹è¯•ç”¨ä¾‹æ•°æ®
const testCases = {
    normal: {
        name: "æ­£å¸¸è¯·æ±‚",
        request: "GET /api/users?id=123&name=john HTTP/1.1",
        params: {id: "123", name: "john"},
        expected: "normal"
    },
    "sql-injection": {
        name: "SQLæ³¨å…¥æ”»å‡»",
        request: "GET /api/users?id=1' OR '1'='1&name=admin HTTP/1.1",
        params: {id: "1' OR '1'='1", name: "admin"},
        expected: "anomaly"
    },
    xss: {
        name: "XSSæ”»å‡»",
        request: "GET /api/search?q=&lt;script&gt;alert('xss')&lt;/script&gt; HTTP/1.1",
        params: {q: "&lt;script&gt;alert('xss')&lt;/script&gt;"},
        expected: "anomaly"
    },
    "path-traversal": {
        name: "è·¯å¾„éå†æ”»å‡»",
        request: "GET /api/files?path=../../../etc/passwd HTTP/1.1",
        params: {path: "../../../etc/passwd"},
        expected: "anomaly"
    }
};

// DOMå…ƒç´ 
const startBtn = document.getElementById('start-demo-btn');
const testCaseSelect = document.getElementById('test-case-select');
const allStageBoxes = document.querySelectorAll('.stage-box');
const progressBar = document.getElementById('progress-bar');
const progressText = document.getElementById('progress-text');
const logContainer = document.getElementById('log-container');
const inferenceTime = document.getElementById('inference-time');
const memoryUsage = document.getElementById('memory-usage');
const cpuUsage = document.getElementById('cpu-usage');
const accuracy = document.getElementById('accuracy');

let animationRunning = false;
const sleep = ms => new Promise(res => setTimeout(res, ms));

const log = (message, type = 'info') => {
    const timestamp = new Date().toLocaleTimeString();
    const logEntry = document.createElement('div');
    logEntry.className = `log-entry ${type}`;
    
    const timeSpan = document.createElement('span');
    timeSpan.className = 'text-gray-500';
    timeSpan.textContent = `[${timestamp}] `;
    
    const messageSpan = document.createElement('span');
    messageSpan.textContent = message;
    
    logEntry.appendChild(timeSpan);
    logEntry.appendChild(messageSpan);
    logContainer.appendChild(logEntry);
    logContainer.scrollTop = logContainer.scrollHeight;
};

const activateStage = (el) => {
    allStageBoxes.forEach(box => box.classList.remove('active'));
    if (el) el.classList.add('active');
};

const updateProgress = (percent) => {
    progressBar.style.width = percent + '%';
    progressText.textContent = percent + '%';
};

const updateMetrics = (time, memory, cpu, acc) => {
    inferenceTime.textContent = time + 'ms';
    memoryUsage.textContent = memory + 'MB';
    cpuUsage.textContent = cpu + '%';
    accuracy.textContent = acc + '%';
};

const simulateAttention = async () => {
    const attentionVis = document.getElementById('attention-vis');
    attentionVis.innerHTML = '';
    
    const container = document.createElement('div');
    container.className = 'flex justify-around items-center h-full';
    
    // åˆ›å»ºQå‘é‡
    const qDiv = document.createElement('div');
    qDiv.className = 'text-center';
    const qLabel = document.createElement('div');
    qLabel.className = 'bg-blue-500 text-white px-2 py-1 rounded mb-2';
    qLabel.textContent = 'Q';
    qDiv.appendChild(qLabel);
    for (let i = 0; i < 3; i++) {
        const dot = document.createElement('div');
        dot.className = 'w-2 h-2 bg-blue-500 rounded-full mx-1 inline-block';
        qDiv.appendChild(dot);
    }
    container.appendChild(qDiv);
    
    // åˆ›å»ºKå‘é‡
    const kDiv = document.createElement('div');
    kDiv.className = 'text-center';
    const kLabel = document.createElement('div');
    kLabel.className = 'bg-red-500 text-white px-2 py-1 rounded mb-2';
    kLabel.textContent = 'K';
    kDiv.appendChild(kLabel);
    for (let i = 0; i < 3; i++) {
        const dot = document.createElement('div');
        dot.className = 'w-2 h-2 bg-red-500 rounded-full mx-1 inline-block';
        kDiv.appendChild(dot);
    }
    container.appendChild(kDiv);
    
    // åˆ›å»ºVå‘é‡
    const vDiv = document.createElement('div');
    vDiv.className = 'text-center';
    const vLabel = document.createElement('div');
    vLabel.className = 'bg-green-500 text-white px-2 py-1 rounded mb-2';
    vLabel.textContent = 'V';
    vDiv.appendChild(vLabel);
    for (let i = 0; i < 3; i++) {
        const dot = document.createElement('div');
        dot.className = 'w-2 h-2 bg-green-500 rounded-full mx-1 inline-block';
        vDiv.appendChild(dot);
    }
    container.appendChild(vDiv);
    
    attentionVis.appendChild(container);
    
    await sleep(1000);
    const heads = attentionVis.querySelectorAll('.w-2');
    heads.forEach((head, index) => {
        setTimeout(() => {
            head.style.transform = 'scale(1.5)';
            head.style.boxShadow = '0 0 10px currentColor';
        }, index * 200);
    });
    
    await sleep(2000);
    heads.forEach(head => {
        head.style.transform = 'scale(1)';
        head.style.boxShadow = 'none';
    });
};

const simulateFFN = async () => {
    const ffnVis = document.getElementById('ffn-vis');
    ffnVis.innerHTML = '';
    
    const ffnBar = document.createElement('div');
    ffnBar.className = 'w-full h-8 bg-gradient-to-r from-purple-500 via-pink-500 to-indigo-500 rounded animate-pulse';
    ffnVis.appendChild(ffnBar);
    
    await sleep(1500);
    ffnBar.classList.remove('animate-pulse');
};

startBtn.addEventListener('click', async () => {
    if (animationRunning) return;
    animationRunning = true;
    startBtn.disabled = true;
    startBtn.textContent = 'æ¼”ç¤ºè¿›è¡Œä¸­...';
    
    // é‡ç½®çŠ¶æ€
    activateStage(null);
    updateProgress(0);
    logContainer.innerHTML = '';
    const initLog = document.createElement('div');
    initLog.className = 'log-entry';
    initLog.textContent = 'ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ...';
    logContainer.appendChild(initLog);
    updateMetrics(0, 0, 0, 0);
    
    const selectedCase = testCases[testCaseSelect.value];
    log('å¼€å§‹æ£€æµ‹: ' + selectedCase.name, 'info');
    
    // 1. HTTPè¯·æ±‚å¤„ç†
    activateStage(document.getElementById('stage-http'));
    // å®‰å…¨æ˜¾ç¤ºHTTPè¯·æ±‚ï¼Œé˜²æ­¢XSS
    const requestElement = document.getElementById('http-request');
    requestElement.textContent = selectedCase.request;
    updateProgress(10);
    log('æ¥æ”¶HTTPè¯·æ±‚', 'info');
    await sleep(1000);
    
    // 2. ç‰¹å¾æå–
    activateStage(document.getElementById('stage-features'));
    updateProgress(25);
    log('å¼€å§‹ç‰¹å¾æå–...', 'info');
    
    // ç»Ÿè®¡ç‰¹å¾
    document.getElementById('statistical-features').classList.add('border-violet-500');
    const statData = 'å‚æ•°é•¿åº¦: ' + Object.values(selectedCase.params).map(p => p.length).join(', ') + '\nå­—ç¬¦åˆ†å¸ƒ: æ•°å­—' + (Math.floor(Math.random() * 30 + 20)) + '%, å­—æ¯' + (Math.floor(Math.random() * 50 + 30)) + '%, ç‰¹æ®Šå­—ç¬¦' + (Math.floor(Math.random() * 20 + 10)) + '%';
    document.getElementById('stat-features-data').textContent = statData;
    await sleep(800);
    
    // è¯­ä¹‰ç‰¹å¾
    document.getElementById('semantic-features').classList.add('border-violet-500');
    const semData = 'Word2VecåµŒå…¥ç»´åº¦: 100\nè¯­ä¹‰ç›¸ä¼¼æ€§: ' + (Math.random() * 0.5 + 0.3).toFixed(3) + '\nè¯æ±‡è¡¨è¦†ç›–ç‡: ' + (Math.random() * 0.3 + 0.6).toFixed(1) + '%';
    document.getElementById('sem-features-data').textContent = semData;
    await sleep(800);
    
    // ç»“æ„ç‰¹å¾
    document.getElementById('structural-features').classList.add('border-violet-500');
    const structData = 'URLæ·±åº¦: ' + (selectedCase.request.split('/').length - 1) + '\nå‚æ•°æ•°é‡: ' + Object.keys(selectedCase.params).length + '\nç¼–ç ç±»å‹: URLç¼–ç ';
    document.getElementById('struct-features-data').textContent = structData;
    await sleep(800);
    
    updateProgress(50);
    log('ç‰¹å¾æå–å®Œæˆ', 'success');
    
    // 3. Transformeræ£€æµ‹
    activateStage(document.getElementById('stage-transformer'));
    updateProgress(60);
    log('å¯åŠ¨Transformeræ£€æµ‹å¼•æ“', 'info');
    
    // æ³¨æ„åŠ›æœºåˆ¶
    document.getElementById('attention-mechanism').style.opacity = 1;
    log('æ‰§è¡Œå¤šå¤´æ³¨æ„åŠ›è®¡ç®—...', 'info');
    await simulateAttention();
    updateProgress(70);
    
    // å‰é¦ˆç½‘ç»œ
    document.getElementById('feed-forward').style.opacity = 1;
    log('æ‰§è¡Œå‰é¦ˆç½‘ç»œå¤„ç†...', 'info');
    await simulateFFN();
    updateProgress(80);
    
    // 4. å†³ç­–å±‚
    activateStage(document.getElementById('stage-decision'));
    updateProgress(90);
    log('ç”Ÿæˆæ£€æµ‹ç»“æœ...', 'info');
    await sleep(1000);
    
    const isAnomaly = selectedCase.expected === 'anomaly';
    const anomalyScore = isAnomaly ? (Math.random() * 0.3 + 0.7) : (Math.random() * 0.2);
    
    const resultElement = document.getElementById('decision-result');
    if (isAnomaly) {
        const anomalyDiv = document.createElement('div');
        anomalyDiv.className = 'anomaly-score';
        anomalyDiv.textContent = 'ğŸš¨ æ£€æµ‹åˆ°å¼‚å¸¸ (' + (anomalyScore * 100).toFixed(1) + '%)';
        resultElement.innerHTML = '';
        resultElement.appendChild(anomalyDiv);
        log('æ£€æµ‹åˆ°å¼‚å¸¸æ”»å‡»ï¼Œç½®ä¿¡åº¦: ' + (anomalyScore * 100).toFixed(1) + '%', 'error');
    } else {
        const normalDiv = document.createElement('div');
        normalDiv.className = 'normal-score';
        normalDiv.textContent = 'âœ… æ­£å¸¸è¯·æ±‚ (' + ((1 - anomalyScore) * 100).toFixed(1) + '%)';
        resultElement.innerHTML = '';
        resultElement.appendChild(normalDiv);
        log('è¯·æ±‚æ­£å¸¸ï¼Œé€šè¿‡æ£€æµ‹', 'success');
    }
    
    updateProgress(100);
    
    // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
    const inferenceTimeMs = Math.floor(Math.random() * 5 + 1);
    const memoryMB = Math.floor(Math.random() * 20 + 80);
    const cpuPercent = Math.floor(Math.random() * 3 + 2);
    const accuracyPercent = Math.floor(Math.random() * 5 + 95);
    
    updateMetrics(inferenceTimeMs, memoryMB, cpuPercent, accuracyPercent);
    
    log('æ£€æµ‹å®Œæˆ', 'success');
    log('æ€§èƒ½æŒ‡æ ‡ - æ¨ç†æ—¶é—´: ' + inferenceTimeMs + 'ms, å†…å­˜: ' + memoryMB + 'MB, CPU: ' + cpuPercent + '%, å‡†ç¡®ç‡: ' + accuracyPercent + '%', 'info');
    
    // é‡ç½®
    setTimeout(() => {
        startBtn.disabled = false;
        startBtn.textContent = 'ğŸ”„ é‡æ–°æ¼”ç¤º';
        animationRunning = false;
    }, 2000);
});

// æµ‹è¯•ç”¨ä¾‹åˆ‡æ¢
testCaseSelect.addEventListener('change', () => {
    if (!animationRunning) {
        const selectedCase = testCases[testCaseSelect.value];
        log('åˆ‡æ¢åˆ°æµ‹è¯•ç”¨ä¾‹: ' + selectedCase.name, 'info');
    }
});
</script>

</body>
</html> 